% 基础包
% 输入编码设置
\usepackage[utf8]{inputenc}
% 字体规范设置包
\usepackage{fontspec}
% 设置等宽字体为 SF Mono，并配置其不同样式
\setmonofont{SF Mono}[
    UprightFeatures={Font=* Regular},      % 常规字体
    BoldFeatures={Font=* Bold},            % 粗体
    ItalicFeatures={Font=* Regular Italic}, % 斜体
    BoldItalicFeatures={Font=* Bold Italic}% 粗斜体
]
% 中文支持包，启用斜体和粗体
\usepackage[SlantFont,BoldFont]{xeCJK}
\usepackage{graphicx}   % 图片支持
\usepackage{geometry}   % 页面布局
\usepackage{titlesec}   % 标题控制
\usepackage{longtable}  % 长表格支持
\usepackage{booktabs}   % 表格美化
\usepackage{array}      % 增强的表格功能
\usepackage{calc}       % 长度计算支持
\usepackage{ragged2e}   % 文本对齐支持
\usepackage{xcolor}     % 颜色支持
\usepackage{fancyvrb}   % 代码高亮支持
\usepackage{fvextra}    % 扩展的代码支持
\usepackage{upquote}    % 智能引号
\usepackage{microtype}  % 微排版
\usepackage{etoolbox}   % 工具包
\usepackage{unicode-math}    % Unicode数学支持
\usepackage{enumitem}       % 列表环境增强
\usepackage{caption}        % 图表标题
\usepackage{subcaption}     % 子图表支持
\usepackage{listings}       % 代码列表
\usepackage{makeidx}        % 索引支持
\usepackage{bookmark}       % PDF书签增强

% 章节设置
\setcounter{secnumdepth}{-1}  % 设置章节编号深度为-1，关闭所有级别章节的编号显示

% 主章节(section)格式设置
\titleformat{\section}
  {\normalfont\Large\bfseries}   % 使用无衬线字体，大号加粗
  {}                             % 不显示章节编号
  {0pt}                          % 标题和编号间距为0
  {\phantomsection}              % 添加PDF书签锚点

% 二级章节(subsection)格式设置
\titleformat{\subsection}
  {\normalfont\large\bfseries}   % 使用无衬线字体，中号加粗
  {}                             % 不显示章节编号
  {0pt}                          % 标题和编号间距为0
  {\phantomsection}              % 添加PDF书签锚点

% 三级章节(subsubsection)格式设置
\titleformat{\subsubsection}
  {\normalfont\normalsize\bfseries}   % 使用无衬线字体，正常大小加粗
  {}                                  % 不显示章节编号
  {0pt}                              % 标题和编号间距为0
  {\phantomsection}                  % 添加PDF书签锚点

% 设置新章节分页
\newcommand{\sectionbreak}{%
  \clearpage                % 在新章节前强制分页
  \phantomsection          % 为新章节添加PDF书签锚点
}

% 定义代码高亮颜色
\definecolor{shadecolor}{RGB}{248,248,248}
\definecolor{commentcolor}{RGB}{128,128,128}
\definecolor{keywordcolor}{RGB}{0,112,192}
\definecolor{stringcolor}{RGB}{0,136,0}
\definecolor{identifiercolor}{RGB}{0,0,0}
\definecolor{numbercolor}{RGB}{128,0,128}

% 设置代码块
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{
    commandchars=\\\{\},
    breaklines=true,
    breakanywhere=true,
    fontsize=\small,
    frame=single,
    rulecolor=\color{black!30},
    framesep=3pt,
    baselinestretch=1.2,
    xleftmargin=0.5em,
    xrightmargin=0.5em,
    formatcom={\normalfont\ttfamily}
}

% 定义代码块背景
\definecolor{shadecolor}{rgb}{.97, .97, .97}
\newenvironment{Shaded}{}{}

% 定义所有必要的代码高亮 token
\newcommand{\KeywordTok}[1]{\textcolor{keywordcolor}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\DecValTok}[1]{\textcolor{numbercolor}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor{numbercolor}{#1}}
\newcommand{\FloatTok}[1]{\textcolor{numbercolor}{#1}}
\newcommand{\CharTok}[1]{\textcolor{stringcolor}{#1}}
\newcommand{\StringTok}[1]{\textcolor{stringcolor}{#1}}
\newcommand{\CommentTok}[1]{\textcolor{commentcolor}{\textit{#1}}}
\newcommand{\OtherTok}[1]{\textcolor{identifiercolor}{#1}}
\newcommand{\AlertTok}[1]{\textcolor{red}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor{identifiercolor}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\ErrorTok}[1]{\textbf{\textcolor{red}{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\VariableTok}[1]{\textcolor{identifiercolor}{#1}}
\newcommand{\ControlFlowTok}[1]{\textbf{#1}}
\newcommand{\ConstantTok}[1]{\textcolor{numbercolor}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor{stringcolor}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor{stringcolor}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor{stringcolor}{#1}}
\newcommand{\ImportTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor{commentcolor}{\textit{#1}}}
\newcommand{\AnnotationTok}[1]{\textcolor{commentcolor}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor{commentcolor}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\InformationTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\WarningTok}[1]{\textcolor{red}{#1}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor{keywordcolor}{#1}}
\newcommand{\SectionTok}[1]{\textbf{#1}}

% 页面设置
\geometry{
    a4paper,
    top=2cm,
    bottom=2cm,
    left=2cm,
    right=2cm,
    headheight=14pt,
    footskip=1cm,
    includehead,
    includefoot
}

% 中文字体设置
\setCJKmainfont[
    BoldFont={Songti SC Bold},
    ItalicFont={Songti SC Light},
    BoldItalicFont={Songti SC Bold}
]{Songti SC}
\setCJKsansfont[
    BoldFont={PingFang SC Semibold},
    ItalicFont={PingFang SC Light}
]{PingFang SC}
\setCJKmonofont{STFangsong}

% 修改中文标点设置，只在正文使用全角标点
\punctstyle{kaiming}  % 改用开明式标点
\normalspacedchars{/}

% 为代码环境单独设置标点样式
\lstset{
    basicstyle=\small\ttfamily,
    breaklines=true,
    frame=single,
    numbers=left,
    numberstyle=\tiny,
    keywordstyle=\color{keywordcolor}\bfseries,
    commentstyle=\color{commentcolor}\itshape,
    stringstyle=\color{stringcolor},
    texcl=true,
    keepspaces=true,
    columns=flexible,
    upquote=true,
    fontadjust=true,
    basewidth={0.5em,0.45em}
}

% 基本命令
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% 添加 pandoc 相关命令
\providecommand{\pandocbounded}[1]{#1}

% 优化段落间距
\setlength{\parskip}{0.5em}
\setlength{\parindent}{2em}

% 在页面设置后添加
\renewcommand{\textfraction}{0.15}
\renewcommand{\topfraction}{0.85}
\renewcommand{\bottomfraction}{0.65}
\renewcommand{\floatpagefraction}{0.60}

% 设置目录深度
\setcounter{tocdepth}{3}
\setcounter{secnumdepth}{3}

% 图片设置
\DeclareGraphicsExtensions{.pdf,.png,.jpg,.jpeg}
\graphicspath{{./}{./images/}}

% 修改图片配置，使其居中显示
\makeatletter
\g@addto@macro\@floatboxreset{%
    \centering  % 添加居中命令
    \linewidth=\textwidth  % 修改为使用完整页面宽度
}
\makeatother

% 重新定义 includegraphics 命令以确保图片不会溢出
\let\oldincludegraphics\includegraphics
\renewcommand{\includegraphics}[2][]{\oldincludegraphics[width=\linewidth,keepaspectratio,#1]{#2}}

% 图片错误处理
\usepackage{silence}
\WarningFilter{latex}{File}
\WarningFilter{latex}{Cannot determine size}

% hyperref 包需要放在最后
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    urlcolor=blue,
    bookmarksnumbered=false,
    bookmarksopen=true,
    pdfstartview=FitH
}